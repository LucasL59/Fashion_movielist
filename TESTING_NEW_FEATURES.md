# 新功能測試指南

## 🎯 測試目標

測試新的三層權限系統和批次管理功能。

## 📋 測試前準備

### 1. 確認服務運行

```bash
# 終端 1: 啟動後端
cd backend
npm run dev

# 終端 2: 啟動前端
cd frontend
npm run dev
```

### 2. 準備測試帳號

建議建立 3 個測試帳號：
- `admin@test.com` - 管理員
- `uploader@test.com` - 上傳者
- `customer@test.com` - 客戶

## 🧪 測試步驟

### 階段 1: 建立測試帳號

#### 1.1 註冊第一個帳號（將成為 Admin）

```
1. 開啟 http://localhost:5173
2. 點擊「註冊」
3. 填寫資料：
   - 姓名: 管理員測試
   - Email: admin@test.com
   - 密碼: Test@123456
4. 點擊「註冊」
5. 檢查 Email 收信
6. 點擊驗證連結
```

#### 1.2 設定為 Admin

```
1. 前往 Supabase Dashboard
   https://supabase.com/dashboard

2. 選擇您的專案

3. 左側選單 → Table Editor → profiles

4. 找到 admin@test.com 的記錄

5. 點擊 role 欄位

6. 改為 'admin'

7. 儲存
```

#### 1.3 註冊其他測試帳號

重複步驟 1.1，建立：
- `uploader@test.com`（姓名: 上傳者測試）
- `customer@test.com`（姓名: 客戶測試）

**注意**: 這兩個帳號保持預設的 `customer` 角色，稍後用 Admin 變更。

---

### 階段 2: 測試 Admin 功能

#### 2.1 登入為 Admin

```
1. 前往 http://localhost:5173
2. 使用 admin@test.com 登入
3. 確認導航欄顯示：
   ✅ 上傳管理
   ✅ 影片清單
   ✅ 用戶管理 ⭐ 新功能
   ✅ 設定
```

#### 2.2 測試用戶管理

```
1. 點擊「用戶管理」

2. 確認看到 3 個用戶：
   - 管理員測試 (admin@test.com) - 管理員
   - 上傳者測試 (uploader@test.com) - 客戶
   - 客戶測試 (customer@test.com) - 客戶

3. 將 uploader@test.com 改為「上傳者」
   - 點擊下拉選單
   - 選擇「上傳者」
   - 確認顯示「角色已更新」

4. 確認 customer@test.com 保持「客戶」

5. 嘗試變更自己的角色
   - 應該顯示「無法變更自己的角色」
```

#### 2.3 測試上傳功能

```
1. 點擊「上傳管理」

2. 上傳測試 Excel
   - 拖曳或選擇檔案
   - 確認上傳成功
   - 看到批次列表

3. 檢查批次資訊
   - 批次名稱
   - 上傳時間
   - 影片數量
   - 刪除按鈕 ⭐ 新功能
```

#### 2.4 測試刪除功能 ⭐ 新功能

```
1. 在批次列表中找到一個批次

2. 點擊右側的垃圾桶圖示

3. 確認彈出確認對話框：
   「確定要刪除批次「XXX」嗎？
   此操作將刪除該批次的所有影片和選擇記錄，且無法復原。」

4. 點擊「取消」
   - 批次應該保留

5. 再次點擊垃圾桶圖示

6. 點擊「確定」
   - 批次應該消失
   - 顯示成功訊息
```

#### 2.5 測試設定頁面

```
1. 點擊右上角頭像 → 設定

2. 確認看到兩個區塊：
   ✅ 個人資料設定
   ✅ 提醒通知設定 ⭐ Admin 專屬

3. 測試提醒設定
   - 選擇日期（例如: 每月 1 號）
   - 填寫提醒內容
   - 儲存
```

---

### 階段 3: 測試 Uploader 功能

#### 3.1 登入為 Uploader

```
1. 登出 Admin 帳號

2. 使用 uploader@test.com 登入

3. 確認導航欄顯示：
   ✅ 上傳管理
   ✅ 影片清單
   ❌ 用戶管理（不應該看到）
   ✅ 設定
```

#### 3.2 測試上傳權限

```
1. 點擊「上傳管理」

2. 上傳測試 Excel
   - 應該可以成功上傳
   - 看到批次列表

3. 檢查批次列表
   - 應該看到所有批次
   - ❌ 沒有刪除按鈕（Uploader 無法刪除）
```

#### 3.3 測試設定頁面

```
1. 點擊右上角頭像 → 設定

2. 確認只看到一個區塊：
   ✅ 個人資料設定
   ❌ 提醒通知設定（不應該看到）
```

#### 3.4 測試無權限功能

```
1. 嘗試訪問 http://localhost:5173/users
   - 應該被重定向或顯示「權限不足」
```

---

### 階段 4: 測試 Customer 功能

#### 4.1 登入為 Customer

```
1. 登出 Uploader 帳號

2. 使用 customer@test.com 登入

3. 確認導航欄顯示：
   ❌ 上傳管理（不應該看到）
   ✅ 影片清單
   ❌ 用戶管理（不應該看到）
   ✅ 設定
```

#### 4.2 測試選擇功能

```
1. 點擊「影片清單」

2. 瀏覽影片
   - 應該看到所有影片
   - 可以選擇影片

3. 選擇幾部影片
   - 點擊「加入清單」
   - 確認選擇狀態

4. 提交選擇
   - 點擊「提交選擇」
   - 確認成功訊息
```

#### 4.3 測試無權限功能

```
1. 嘗試訪問 http://localhost:5173/admin
   - 應該被重定向到首頁

2. 嘗試訪問 http://localhost:5173/users
   - 應該被重定向或顯示「權限不足」
```

---

## ✅ 測試檢查清單

### Admin 功能
- [ ] 可以登入
- [ ] 看到「用戶管理」選單
- [ ] 可以變更其他用戶角色
- [ ] 無法變更自己的角色
- [ ] 可以上傳 Excel
- [ ] 可以刪除批次
- [ ] 刪除前有確認對話框
- [ ] 可以看到提醒設定

### Uploader 功能
- [ ] 可以登入
- [ ] 看到「上傳管理」選單
- [ ] 看不到「用戶管理」選單
- [ ] 可以上傳 Excel
- [ ] 看不到刪除按鈕
- [ ] 看不到提醒設定
- [ ] 無法訪問 /users

### Customer 功能
- [ ] 可以登入
- [ ] 看不到「上傳管理」選單
- [ ] 看不到「用戶管理」選單
- [ ] 可以瀏覽影片
- [ ] 可以選擇影片
- [ ] 可以提交選擇
- [ ] 無法訪問 /admin
- [ ] 無法訪問 /users

### 資料庫安全
- [ ] Customer 無法透過 API 刪除批次
- [ ] Uploader 無法透過 API 刪除批次
- [ ] Customer 無法透過 API 查看其他人的選擇
- [ ] 只有 Admin 可以查看所有用戶

---

## 🐛 常見問題

### Q: 登入後看不到正確的選單

**A**: 檢查以下幾點：
1. 確認資料庫中的 role 欄位正確
2. 清除瀏覽器快取
3. 重新登入
4. 檢查瀏覽器 F12 Console 是否有錯誤

### Q: 無法變更用戶角色

**A**: 
1. 確認您是以 Admin 身份登入
2. 檢查 Supabase RLS 政策是否正確
3. 查看瀏覽器 F12 Network 標籤的錯誤訊息

### Q: 刪除按鈕沒有出現

**A**:
1. 確認您是以 Admin 身份登入（Uploader 看不到）
2. 重新整理頁面
3. 檢查 user.role 是否為 'admin'

### Q: 上傳後沒有收到 Email

**A**:
1. 檢查 backend/.env 的 Email 設定
2. 查看後端 console 的錯誤訊息
3. 確認 Azure AD 設定正確
4. 檢查垃圾郵件資料夾

---

## 📊 測試結果記錄

### 測試環境
- 日期: ___________
- 測試人員: ___________
- 瀏覽器: ___________
- Node.js 版本: ___________

### 測試結果

| 功能 | 通過 | 失敗 | 備註 |
|------|------|------|------|
| Admin 登入 | ☐ | ☐ | |
| Admin 用戶管理 | ☐ | ☐ | |
| Admin 刪除批次 | ☐ | ☐ | |
| Admin 提醒設定 | ☐ | ☐ | |
| Uploader 登入 | ☐ | ☐ | |
| Uploader 上傳 | ☐ | ☐ | |
| Uploader 權限限制 | ☐ | ☐ | |
| Customer 登入 | ☐ | ☐ | |
| Customer 選擇 | ☐ | ☐ | |
| Customer 權限限制 | ☐ | ☐ | |

### 發現的問題
1. ___________________________________________
2. ___________________________________________
3. ___________________________________________

---

## 🎉 測試完成

如果所有測試都通過，恭喜！新的權限系統已經可以正常使用了。

### 下一步
1. 閱讀 [PERMISSION_SYSTEM_UPDATE.md](PERMISSION_SYSTEM_UPDATE.md)
2. 設定正式環境的第一個 Admin
3. 開始使用系統

### 需要幫助？
如有問題，請參考：
- [ANSWERS_TO_YOUR_QUESTIONS.md](ANSWERS_TO_YOUR_QUESTIONS.md)
- [QUICK_START.md](QUICK_START.md)
- [README.md](README.md)

---

**測試指南版本**: 1.0  
**最後更新**: 2024-11-21

