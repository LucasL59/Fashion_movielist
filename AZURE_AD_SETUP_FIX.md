# Azure AD Client Secret è¨­å®šä¿®æ­£æŒ‡å—

## âŒ å¸¸è¦‹éŒ¯èª¤

éŒ¯èª¤è¨Šæ¯ï¼š
```
AADSTS7000215: Invalid client secret provided. 
Ensure the secret being sent in the request is the client secret value, 
not the client secret ID
```

## ğŸ” å•é¡ŒåŸå› 

åœ¨ Azure Portal å»ºç«‹ Client Secret æ™‚ï¼Œæœƒé¡¯ç¤ºå…©å€‹å€¼ï¼š
- **Secret ID**ï¼ˆéŒ¯èª¤ï¼‰ï¼š`2e4e6012-d809-4cb5-b213-ea7221c46814`
- **Value**ï¼ˆæ­£ç¢ºï¼‰ï¼š`abc~defGHI123jkl456MNO789pqr`

å¾ˆå¤šäººæœƒèª¤å°‡ **Secret ID** å¡«å…¥ `.env`ï¼Œä½†å¯¦éš›ä¸Šæ‡‰è©²å¡«å…¥ **Value**ã€‚

## âœ… æ­£ç¢ºè¨­å®šæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå‰å¾€ Azure Portal

1. ç™»å…¥ https://portal.azure.com
2. æœå°‹ã€ŒAzure Active Directoryã€
3. é»æ“Šã€ŒApp registrationsã€
4. é¸æ“‡æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ï¼ˆä¾‹å¦‚ï¼šMovie Selection Systemï¼‰

### æ­¥é©Ÿ 2ï¼šæŸ¥çœ‹æˆ–å»ºç«‹ Client Secret

1. é»æ“Šå·¦å´ã€ŒCertificates & secretsã€
2. é»æ“Šã€ŒClient secretsã€æ¨™ç±¤

#### å¦‚æœå·²æœ‰ Secretï¼š
- æŸ¥çœ‹ã€ŒValueã€æ¬„ä½
- âš ï¸ **é‡è¦**ï¼šå¦‚æœé¡¯ç¤ºã€Œâ€¢â€¢â€¢â€¢â€¢â€¢ã€ï¼Œè¡¨ç¤ºç„¡æ³•å†æŸ¥çœ‹ï¼Œéœ€è¦å»ºç«‹æ–°çš„

#### å¦‚æœéœ€è¦å»ºç«‹æ–°çš„ Secretï¼š
1. é»æ“Šã€Œ+ New client secretã€
2. å¡«å¯«æè¿°ï¼š`Movie Selection API Key`
3. é¸æ“‡éæœŸæ™‚é–“ï¼šå»ºè­° 24 months
4. é»æ“Šã€ŒAddã€
5. **ç«‹å³è¤‡è£½ Value æ¬„ä½çš„å€¼**ï¼ˆé›¢é–‹å¾Œç„¡æ³•å†æŸ¥çœ‹ï¼‰

### æ­¥é©Ÿ 3ï¼šè­˜åˆ¥æ­£ç¢ºçš„å€¼

```
æ¬„ä½åç¨±        ç¯„ä¾‹å€¼                                    æ˜¯å¦æ­£ç¢º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Secret ID      2e4e6012-d809-4cb5-b213-ea7221c46814      âŒ éŒ¯èª¤
Value          abc~defGHI123jkl456MNO789pqr              âœ… æ­£ç¢º
Description    Movie Selection API Key                    â„¹ï¸ åƒ…ä¾›åƒè€ƒ
Expires        2026-11-21                                 â„¹ï¸ åƒ…ä¾›åƒè€ƒ
```

**è­˜åˆ¥ç‰¹å¾µ**ï¼š
- âœ… **Value** é€šå¸¸åŒ…å« `~` ç¬¦è™Ÿ
- âœ… **Value** é•·åº¦è¼ƒé•·ï¼ˆ30-40 å­—å…ƒï¼‰
- âŒ **Secret ID** æ˜¯æ¨™æº– UUID æ ¼å¼ï¼ˆ8-4-4-4-12ï¼‰

### æ­¥é©Ÿ 4ï¼šæ›´æ–° .env æª”æ¡ˆ

ç·¨è¼¯ `backend/.env`ï¼š

```env
# âŒ éŒ¯èª¤ç¯„ä¾‹ï¼ˆä½¿ç”¨ Secret IDï¼‰
AZURE_CLIENT_SECRET=2e4e6012-d809-4cb5-b213-ea7221c46814

# âœ… æ­£ç¢ºç¯„ä¾‹ï¼ˆä½¿ç”¨ Valueï¼‰
AZURE_CLIENT_SECRET=abc~defGHI123jkl456MNO789pqr
```

### æ­¥é©Ÿ 5ï¼šé‡å•Ÿå¾Œç«¯æœå‹™

```bash
# åœæ­¢å¾Œç«¯ï¼ˆCtrl+Cï¼‰
# é‡æ–°å•Ÿå‹•
cd backend
npm run dev
```

## ğŸ§ª æ¸¬è©¦è¨­å®š

### æ–¹æ³• 1ï¼šæŸ¥çœ‹å•Ÿå‹•æ—¥èªŒ

å•Ÿå‹•å¾Œç«¯å¾Œï¼Œå¦‚æœæ²’æœ‰çœ‹åˆ° Azure AD ç›¸é—œéŒ¯èª¤ï¼Œè¡¨ç¤ºè¨­å®šæ­£ç¢ºã€‚

### æ–¹æ³• 2ï¼šæ¸¬è©¦ Email åŠŸèƒ½

1. ç™»å…¥ç³»çµ±
2. é¸æ“‡å¹¾éƒ¨å½±ç‰‡
3. é»æ“Šã€Œæäº¤é¸æ“‡ã€
4. æª¢æŸ¥å¾Œç«¯æ—¥èªŒï¼š
   - âœ… æˆåŠŸï¼š`âœ… Email å·²ç™¼é€è‡³ xxx@example.com`
   - âŒ å¤±æ•—ï¼š`ç²å– Access Token å¤±æ•—: invalid_client`

### æ–¹æ³• 3ï¼šä½¿ç”¨ curl æ¸¬è©¦

```bash
curl -X POST https://login.microsoftonline.com/{TENANT_ID}/oauth2/v2.0/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id={CLIENT_ID}" \
  -d "client_secret={CLIENT_SECRET}" \
  -d "scope=https://graph.microsoft.com/.default" \
  -d "grant_type=client_credentials"
```

æ›¿æ› `{TENANT_ID}`, `{CLIENT_ID}`, `{CLIENT_SECRET}` ç‚ºæ‚¨çš„å¯¦éš›å€¼ã€‚

## ğŸ“‹ å®Œæ•´æª¢æŸ¥æ¸…å–®

- [ ] å·²å‰å¾€ Azure Portal
- [ ] å·²æ‰¾åˆ°æ­£ç¢ºçš„æ‡‰ç”¨ç¨‹å¼
- [ ] å·²é€²å…¥ã€ŒCertificates & secretsã€
- [ ] å·²è¤‡è£½ **Value**ï¼ˆä¸æ˜¯ Secret IDï¼‰
- [ ] Value åŒ…å« `~` ç¬¦è™Ÿ
- [ ] å·²æ›´æ–° `backend/.env` ä¸­çš„ `AZURE_CLIENT_SECRET`
- [ ] å·²é‡å•Ÿå¾Œç«¯æœå‹™
- [ ] å·²æ¸¬è©¦ Email åŠŸèƒ½

## ğŸ” å®‰å…¨æ€§æé†’

1. **æ°¸é ä¸è¦æäº¤ `.env` åˆ° Git**
2. **Value åªæœƒé¡¯ç¤ºä¸€æ¬¡**ï¼Œå»ºç«‹å¾Œç«‹å³è¤‡è£½ä¸¦å®‰å…¨ä¿å­˜
3. **å®šæœŸæ›´æ–° Secret**ï¼ˆå»ºè­°æ¯å¹´æ›´æ–°ï¼‰
4. **ä¸è¦åœ¨å…¬é–‹å ´åˆåˆ†äº« Secret**

## â“ å¸¸è¦‹å•é¡Œ

### Q: æˆ‘å¿˜è¨˜è¤‡è£½ Value äº†æ€éº¼è¾¦ï¼Ÿ

A: ç„¡æ³•å†æ¬¡æŸ¥çœ‹ï¼Œå¿…é ˆå»ºç«‹æ–°çš„ Client Secretã€‚

### Q: å¯ä»¥åŒæ™‚æœ‰å¤šå€‹ Client Secret å—ï¼Ÿ

A: å¯ä»¥ï¼å»ºè­°åœ¨æ›´æ–°å‰å…ˆå»ºç«‹æ–°çš„ï¼Œæ¸¬è©¦æˆåŠŸå¾Œå†åˆªé™¤èˆŠçš„ã€‚

### Q: Secret éæœŸäº†æ€éº¼è¾¦ï¼Ÿ

A: åœ¨éæœŸå‰å»ºç«‹æ–°çš„ Secretï¼Œæ›´æ–° `.env`ï¼Œé‡å•Ÿæœå‹™ã€‚

### Q: é‚„æ˜¯é¡¯ç¤º invalid_client éŒ¯èª¤ï¼Ÿ

A: æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š
1. Client ID æ˜¯å¦æ­£ç¢º
2. Tenant ID æ˜¯å¦æ­£ç¢º
3. API æ¬Šé™æ˜¯å¦å·²æˆäºˆç®¡ç†å“¡åŒæ„
4. Secret æ˜¯å¦å·²éæœŸ

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥é©Ÿä»ç„¡æ³•è§£æ±ºï¼Œè«‹æª¢æŸ¥ï¼š
1. Azure Portal ä¸­çš„ã€ŒAPI permissionsã€æ˜¯å¦åŒ…å« `Mail.Send`
2. æ˜¯å¦å·²é»æ“Šã€ŒGrant admin consentã€
3. ADMIN_EMAIL æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ Microsoft 365 å¸³è™Ÿ

---

**æç¤º**ï¼šå°‡æ­¤æ–‡ä»¶åŠ å…¥æ›¸ç±¤ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è¨­å®šæ™‚åƒè€ƒï¼

