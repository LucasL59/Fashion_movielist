# Render ç’°å¢ƒè®Šæ•¸æ›´æ–°æŒ‡å—

## ğŸ¯ éœ€è¦æ›´æ–°çš„ç’°å¢ƒè®Šæ•¸

```
ADMIN_EMAIL=support@fas.com.tw
```

## ğŸ“ æ›´æ–°æ­¥é©Ÿ

### 1. ç™»å…¥ Render Dashboard
å‰å¾€ï¼šhttps://dashboard.render.com/

### 2. é¸æ“‡ Backend Service
- åœ¨ Dashboard ä¸­æ‰¾åˆ°æ‚¨çš„å¾Œç«¯æœå‹™ï¼ˆé€šå¸¸åç¨±åŒ…å« "backend" æˆ– "api"ï¼‰
- é»æ“Šé€²å…¥æœå‹™è©³æƒ…é é¢

### 3. é€²å…¥ç’°å¢ƒè®Šæ•¸è¨­å®š
- é»æ“Šå·¦å´é¸å–®çš„ **"Environment"** æ¨™ç±¤
- æˆ–ç›´æ¥é»æ“Šé ‚éƒ¨çš„ **"Environment"** æŒ‰éˆ•

### 4. æ›´æ–° ADMIN_EMAIL
1. åœ¨ç’°å¢ƒè®Šæ•¸åˆ—è¡¨ä¸­æ‰¾åˆ° `ADMIN_EMAIL`
2. é»æ“Šå³å´çš„ **"Edit"** æŒ‰éˆ•ï¼ˆé‰›ç­†åœ–ç¤ºï¼‰
3. å°‡å€¼ä¿®æ”¹ç‚ºï¼š`support@fas.com.tw`
4. é»æ“Š **"Save Changes"** æŒ‰éˆ•

### 5. ç­‰å¾…æœå‹™é‡å•Ÿ
- Render æœƒè‡ªå‹•é‡å•Ÿæœå‹™ä»¥å¥—ç”¨æ–°çš„ç’°å¢ƒè®Šæ•¸
- é‡å•Ÿéç¨‹å¤§ç´„éœ€è¦ 1-2 åˆ†é˜
- å¯ä»¥åœ¨ "Logs" æ¨™ç±¤ä¸­æŸ¥çœ‹é‡å•Ÿé€²åº¦

## âœ… é©—è­‰æ›´æ–°

### æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦ç”Ÿæ•ˆ
åœ¨ Render çš„ "Logs" æ¨™ç±¤ä¸­ï¼ŒæŸ¥çœ‹æœå‹™å•Ÿå‹•æ—¥èªŒï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ°æ–°çš„ç’°å¢ƒè®Šæ•¸è¢«è¼‰å…¥ã€‚

### æ¸¬è©¦éƒµä»¶ç™¼é€
1. ä½¿ç”¨æ¸¬è©¦å¸³è™Ÿç™»å…¥å‰ç«¯ç³»çµ±
2. é¸æ“‡å½±ç‰‡ä¸¦æäº¤
3. åœ¨ Render "Logs" ä¸­æœå°‹ä»¥ä¸‹é—œéµå­—ï¼š
   - `[getAdminRecipients]` - æŸ¥çœ‹ç®¡ç†å“¡æŸ¥è©¢çµæœ
   - `æœ€çµ‚æ”¶ä»¶äººåˆ—è¡¨` - æŸ¥çœ‹æœ€çµ‚çš„æ”¶ä»¶äººæ¸…å–®
   - `âœ… Email å·²ç™¼é€è‡³` - ç¢ºèªéƒµä»¶ç™¼é€ç‹€æ…‹

### é æœŸçµæœ
å¦‚æœè³‡æ–™åº«ä¸­æœ‰ç®¡ç†å“¡è§’è‰²çš„ç”¨æˆ¶ï¼Œéƒµä»¶æ‡‰è©²ç™¼é€çµ¦ï¼š
1. æ‰€æœ‰ `role='admin'` çš„ç”¨æˆ¶
2. æ‰¹æ¬¡çš„ä¸Šå‚³è€…ï¼ˆå¦‚æœä¸æ˜¯æœ¬æ¬¡ä¸Šå‚³è€…ï¼‰
3. `mail_rules` è¡¨ä¸­è¨­å®šçš„é¡å¤–æ”¶ä»¶äºº

å¦‚æœè³‡æ–™åº«ä¸­æ²’æœ‰ç®¡ç†å“¡ï¼Œå‰‡æœƒ fallback åˆ° `support@fas.com.tw`

## ğŸ” æ•…éšœæ’é™¤

### å•é¡Œ 1: ç’°å¢ƒè®Šæ•¸æ›´æ–°å¾Œæ²’æœ‰ç”Ÿæ•ˆ
**è§£æ±ºæ–¹æ¡ˆ**:
- ç¢ºèªå·²é»æ“Š "Save Changes"
- æ‰‹å‹•é‡å•Ÿæœå‹™ï¼šé»æ“Šå³ä¸Šè§’çš„ "Manual Deploy" > "Clear build cache & deploy"

### å•é¡Œ 2: éƒµä»¶ä»ç„¶ç™¼é€åˆ°èˆŠçš„åœ°å€
**å¯èƒ½åŸå› **:
1. **è³‡æ–™åº«ä¸­æœ‰ç®¡ç†å“¡è§’è‰²çš„ç”¨æˆ¶**
   - æª¢æŸ¥ `profiles` è¡¨ï¼Œç¢ºèª `role='admin'` çš„ç”¨æˆ¶éƒµç®±
   - ç³»çµ±æœƒå„ªå…ˆä½¿ç”¨è³‡æ–™åº«ä¸­çš„ç®¡ç†å“¡éƒµç®±

2. **mail_rules è¡¨ä¸­æœ‰è¨­å®š**
   - æª¢æŸ¥ `mail_rules` è¡¨ä¸­ `event_type='selection_submitted'` çš„è¨˜éŒ„
   - é€™äº›éƒµç®±æœƒè¢«åˆä½µåˆ°æ”¶ä»¶äººåˆ—è¡¨ä¸­

**æª¢æŸ¥æ–¹æ³•**:
åœ¨ Supabase Dashboard ä¸­åŸ·è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æª¢æŸ¥ç®¡ç†å“¡ç”¨æˆ¶
SELECT id, email, name, role 
FROM profiles 
WHERE role = 'admin';

-- æª¢æŸ¥éƒµä»¶è¦å‰‡
SELECT * 
FROM mail_rules 
WHERE event_type = 'selection_submitted';
```

### å•é¡Œ 3: æ‰¾ä¸åˆ° ADMIN_EMAIL ç’°å¢ƒè®Šæ•¸
**è§£æ±ºæ–¹æ¡ˆ**:
1. é»æ“Š "Add Environment Variable" æŒ‰éˆ•
2. Key: `ADMIN_EMAIL`
3. Value: `support@fas.com.tw`
4. é»æ“Š "Save"

## ğŸ“Š ç’°å¢ƒè®Šæ•¸èªªæ˜

### ADMIN_EMAIL çš„ä½œç”¨
é€™å€‹ç’°å¢ƒè®Šæ•¸æ˜¯ **fallback æ©Ÿåˆ¶**ï¼Œåªæœ‰åœ¨ä»¥ä¸‹æƒ…æ³ä¸‹æ‰æœƒä½¿ç”¨ï¼š

1. è³‡æ–™åº«ä¸­æ²’æœ‰ `role='admin'` çš„ç”¨æˆ¶
2. æ‰€æœ‰ç®¡ç†å“¡éƒ½æ²’æœ‰è¨­å®š email
3. `mail_rules` è¡¨ä¸­æ²’æœ‰ç›¸é—œè¦å‰‡

### å„ªå…ˆé †åº
```
1. è³‡æ–™åº«ä¸­çš„ç®¡ç†å“¡ (profiles.role='admin')
2. æ‰¹æ¬¡ä¸Šå‚³è€… (batches.uploader_id)
3. éƒµä»¶è¦å‰‡ (mail_rules.event_type='selection_submitted')
4. ç’°å¢ƒè®Šæ•¸ ADMIN_EMAIL (fallback)
```

## ğŸ”— ç›¸é—œè³‡æº

- [Render ç’°å¢ƒè®Šæ•¸æ–‡æª”](https://render.com/docs/environment-variables)
- [éƒ¨ç½²æª¢æŸ¥æ¸…å–®](./DEPLOYMENT_CHECKLIST_v2.2.8.md)
- [éƒµä»¶æœå‹™å¯¦ä½œ](./backend/src/services/emailService.js)

## ğŸ“ éœ€è¦å”åŠ©ï¼Ÿ

å¦‚æœåœ¨æ›´æ–°éç¨‹ä¸­é‡åˆ°å•é¡Œï¼Œè«‹ï¼š
1. æª¢æŸ¥ Render Logs ä¸­çš„éŒ¯èª¤è¨Šæ¯
2. ç¢ºèªè³‡æ–™åº«ä¸­çš„ç®¡ç†å“¡è¨­å®š
3. æŸ¥çœ‹æœ¬æ–‡æª”çš„æ•…éšœæ’é™¤ç« ç¯€

